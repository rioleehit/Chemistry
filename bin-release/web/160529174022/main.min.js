var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?r(s):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),r=i.prototype;return r.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},r.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},r.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},r.createScene=function(){if(this.isThemeLoadEnd&&this.isResourceLoadEnd){var t=new GameMain;this.addChild(t)}},r.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},r.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},r.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(eui.UILayer);egret.registerClass(Main,"Main");var Button=function(t){function e(){t.call(this),this.skinName="resource/rioSkin/rioSetingButtonSkin.exml"}__extends(e,t);var i=__define,r=e,s=r.prototype;return i(s,"label",void 0,function(t){this.btnImg.source=t}),s.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);egret.registerClass(Button,"Button");var ChooseChecker=function(){function t(){}var e=(__define,t),i=e.prototype;return i.check=function(t,e,i){for(var r=!0,s=e.getPos(),a=0==t.length,n=0;n<t.length&&r;n++)r=t[n].ballType==e.ballType,a=a?a:r&&t[n].distance(s.x,s.y)<2.05*i;return r&&a},t}();egret.registerClass(ChooseChecker,"ChooseChecker");var GameLayer=function(t){function e(e){t.call(this),this.stageInfo=e,this.logic=new GameLogic(e),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.gameStart,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.gameEnd,this),this.stateGame="ending",this.touchEnabled=!0;var i=new eui.Button;i.label="Click!",i.horizontalCenter=140,i.verticalCenter=-400,this.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addBall,this),this.balls=new Array,this.initDebugDraw(),this.preIniter=e.lvData.length,this.ballTimer=new egret.Timer(500,this.preIniter),this.ballTimer.addEventListener(egret.TimerEvent.TIMER,function(){if(!(this.preIniter<=0)){this.preIniter--;for(var t=this.stageInfo.lvData[this.preIniter],e=this.stageInfo.height/(this.stageInfo.lvData.length-this.preIniter+1),i=this.stageInfo.width/(t.length+1),r=0;r<t.length;r++)this._addBall((r+1)*i,e,t[r])}},this),this.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){},this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.pause=function(t){"playing"==this.stateGame?this.gamePause():"pausing"==this.stateGame&&this.gameResume()},r.initDebugDraw=function(){var t=new egret.Sprite;this.addChild(t),this.p2Draw=new p2DebugDraw(this.logic.getWorld(),t),this.p2Draw.factor=SpritePhysic.factor,this.p2Draw.winHeight=SpritePhysic.stageHeight},r.gameStart=function(){"ending"==this.stateGame&&(this.initLogic(),this.stateGame="playing",this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchCancel,this),this.addEventListener(egret.Event.ENTER_FRAME,this.debugDraw,this),this.stage.addEventListener(egret.Event.ACTIVATE,this.focuse_in,this),this.stage.addEventListener(egret.Event.DEACTIVATE,this.focuse_out,this),this.ballTimer.start())},r.focuse_in=function(t){this.gameResume()},r.focuse_out=function(t){this.gamePause()},r.addBall=function(t){var e=Math.floor(Math.random()*this.stageInfo.persent.length);this._addBall(t.stageX,t.stageY,this.stageInfo.persent[e])},r._addBall=function(t,e,i){console.log(i);var r=Template.createBall(i);r.pos(t,e),this.logic.add(r)},r.touchBegin=function(t){},r.touchMove=function(t){},r.touchCancel=function(t){console.log("touchCancel"),this.logic.freeChosen()},r.touchEnd=function(t){this.logic.destroyAtoms()},r.gamePause=function(){"pausing"!=this.stateGame&&(this.stateGame="pausing",this.logic.pause())},r.gameResume=function(){"playing"!=this.stateGame&&(this.stateGame="playing",this.logic.resume())},r.gameEnd=function(){"ending"!=this.stateGame&&(this.stateGame="ending",this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchCancel,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.debugDraw,this))},r.onChosen=function(t){t.chosenTag||this.logic.choose(t)},r.initLogic=function(){var t=this,e=this,i=this.logic;i.onAtomAdd=function(i){i.img.alpha=1,e.addChild(i.img),i instanceof SpritePhysic&&(i.onChosen=t.onChosen.bind(t))},i.onAtomChosen=function(t){t.img.alpha=1},i.onAtomChosen=function(t){t.img.alpha=.5},i.onAtomDestroy=function(t){t.img.alpha=.1,e.removeChild(t.img)},i.onAtomUnchosen=function(t){t.img.alpha=1},i.init()},r.debugDraw=function(){this.p2Draw},e}(eui.UILayer);egret.registerClass(GameLayer,"GameLayer");var GameLogic=function(){function t(t){this.stageInfo=t,this.onAtomChosen=function(t){},this.onAtomUnchosen=function(t){},this.onAtomAdd=function(t){},this.onAtomDestroy=function(t){},this.checker=new ChooseChecker,this.world=new p2.World,this.world.gravity=[0,-1],this.world.sleepMode=p2.World.NO_SLEEPING,this.initGround()}var e=(__define,t),i=e.prototype;return i.init=function(){this.atoms=new Array,this.atomChosen=new Array,this.chosenCount=0,this.isPause=!1},i.add=function(t){t.chosenTag=!1,this.atoms[t.id]=t,this.world.addBody(t),this.onAtomAdd(t)},i.choose=function(t){!t.chosenTag&&this.checker.check(this.atomChosen,t,SpritePhysic.factor)&&(this.chosenCount++,this.atomChosen.push(t),this.onAtomChosen(t),t.chosenTag=!0)},i.freeChosen=function(){for(var t=0;t<this.atomChosen.length;t++){var e=this.atomChosen[t];e&&e.chosenTag&&(e.chosenTag=!1,this.onAtomUnchosen(e))}this.atomChosen=new Array},i.destroyAtoms=function(){for(var t=0;t<this.atomChosen.length;t++){var e=this.atomChosen[t],i=e.id;e&&e.chosenTag&&(e.chosenTag=!1,this.world.removeBody(e)),this.atoms[i]=null}this.atomChosen=new Array},i.getWorld=function(){return this.world},i.getAllAtomBall=function(){return this.atoms},i.pause=function(){this.isPause=!0},i.resume=function(){this.isPause=!1},i.initGround=function(){var t=this.world;t.setGlobalStiffness(1e8);var e=SpritePhysic.factor,i=this.stageInfo,r=new p2.Plane,s=new p2.Body;s.addShape(r,[0,(i.frameOffset+10)/e]),r=new p2.Plane,s.addShape(r,[0,(i.height-i.frameOffset)/e],Math.PI),r=new p2.Plane,s.addShape(r,[(i.width-i.frameOffset)/e,0],Math.PI/2),r=new p2.Plane,s.addShape(r,[i.frameOffset/e,i.width/e],-Math.PI/2),s.type=p2.Body.STATIC;var a=new p2.Plane,n=new p2.Body;n.addShape(a),n.position[1]=10,t.addBody(s),t.on("addBody",function(t){t.body&&t.body instanceof SpritePhysic&&this.onAtomAdd&&this.onAtomAdd(t.body)},this),t.on("removeBody",function(t){t.body&&t.body instanceof SpritePhysic&&this.onAtomDestroy&&this.onAtomDestroy(t.body)},this),egret.startTick(function(e){if(!this.timeStamp)return this.timeStamp=e,!1;var i=e-this.timeStamp;if(0==this.isPause&&40>i){t.step(i/200);for(var r=t.bodies.length,s=0;r>s;s++){var a=t.bodies[s];a instanceof SpritePhysic&&a.update()}}return this.timeStamp=e,!0},this)},t}();egret.registerClass(GameLogic,"GameLogic");var GameMain=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.init,this),this.skinName="resource/rioSkin/GameMainSkin.exml"}__extends(e,t);var i=(__define,e),r=i.prototype;return r.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_start.label=RES.getRes("t_start_png")},r.init=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.init,this),this.stageInfo={width:this.stage.stageWidth,height:this.stage.stageHeight,frameOffset:20};var t=8;SpritePhysic.factor=(this.stageInfo.width-2*this.stageInfo.frameOffset)/(2*t),SpritePhysic.stageHeight=this.stage.stageHeight,this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addBall,this)},r.addBall=function(t){if(!this.gameLayer){var e=RES.getRes("level_json");this.stageInfo.lv="lv1",this.stageInfo.lvData=e.lv1;var i=e["lv1_概率"];this.stageInfo.persent=new Array(500);var r=0,s=0;for(var a in i){r=s,s+=i[a]*this.stageInfo.persent.length;for(var n=r;s>n;n++)this.stageInfo.persent[n]=a}return this.gameLayer=new GameLayer(this.stageInfo),void this.addChild(this.gameLayer)}},e}(eui.Panel);egret.registerClass(GameMain,"GameMain");var p2DebugDraw=function(){function t(t,e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.COLOR_BLACK=0,this.COLOR_RED=16711680,this.isDrawAABB=!1,this.factor=30,this.winHeight=800,this.world=t,this.sprite=e}var e=(__define,t),i=e.prototype;return i.drawDebug=function(){this.sprite.graphics.clear();for(var t=this.world.bodies.length,e=0;t>e;e++)for(var i=this.world.bodies[e],r=0;r<i.shapes.length;r++){var s=i.shapes[r];this.drawShape(s,i),this.isDrawAABB&&this.drawAABB(i)}t=this.world.constraints.length;for(var a,r=0;t>r;r++)switch(a=this.world.constraints[r],a.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(a);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(a);break;case p2.Constraint.GEAR:this.drawGearJoint(a);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(a);break;case p2.Constraint.LOCK:this.drawLockJoint(a)}t=this.world.springs.length;for(var n,o=0;t>o;o++)n=this.world.springs[o],n instanceof p2.LinearSpring?this.drawLinearSpring(n):n instanceof p2.RotationalSpring&&this.drawRotationalSpring(n)},i.drawAABB=function(t){var e=new Array,i=t.aabb.lowerBound[0],r=t.aabb.lowerBound[1],s=t.aabb.upperBound[0],a=t.aabb.upperBound[1];isFinite(i)&&isFinite(r)&&isFinite(s)&&isFinite(a)&&(e.push([i,r],[s,r],[s,a],[i,a]),this.drawConvex(e,this.COLOR_S,1,!1))},i.drawDistanceJoint=function(t){var e,i=new Array,r=new Array;e=t.distance,t.upperLimitEnabled&&t.upperLimit>e&&(e=t.upperLimit),t.bodyA.toWorldFrame(i,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var s=p2.vec2.subtract([],r,i);p2.vec2.normalize(s,s),p2.vec2.scale(s,s,e);var a=p2.vec2.add([],i,s);this.drawSegment(i,t.bodyA.position,this.COLOR_S),this.drawSegment(r,t.bodyB.position,this.COLOR_S),this.drawVecAt(s,i,this.COLOR_BLACK),t.position>e&&this.drawSegment(r,a,this.COLOR_RED),this.drawCircle(i,3/this.factor,this.COLOR_BLACK),this.drawCircle(a,3/this.factor,this.COLOR_BLACK),t.lowerLimitEnabled&&(p2.vec2.normalize(s,s),p2.vec2.scale(s,s,t.lowerLimit),a=p2.vec2.add([],i,s),this.drawCircle(a,2/this.factor,this.COLOR_BLACK))},i.drawRevoluteJoint=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.pivotA),t.bodyB.toWorldFrame(i,t.pivotB),this.drawSegment(t.bodyA.position,e,this.COLOR_S),this.drawSegment(t.bodyB.position,i,this.COLOR_S),this.drawSegment(e,i,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK)},i.drawGearJoint=function(t){var e=t.bodyA.position,i=t.bodyB.position,r=new Array,s=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(s,[20/this.factor,0]);var a=p2.vec2.subtract([],e,r),n=p2.vec2.subtract([],i,s);this.drawVecAt(a,e,this.COLOR_BLACK,!0),this.drawVecAt(n,i,this.COLOR_BLACK,!0),t.bodyB.toWorldFrame(n,[10*(t.bodyB.angle-t.bodyA.angle-t.angle)/this.factor,0]),this.drawSegment(n,i,this.COLOR_RED)},i.drawPrismaticJoint=function(t){var e=(t.bodyA.position,t.bodyB.position,new Array),i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=new Array;r=this.toWorldVector(t.localAxisA,t.bodyA);var s=p2.vec2.copy([],r),a=p2.vec2.copy([],r);t.lowerLimitEnabled?p2.vec2.scale(s,r,t.lowerLimit):p2.vec2.scale(s,r,5e3),t.upperLimitEnabled?p2.vec2.scale(a,r,t.upperLimit):p2.vec2.scale(a,r,5e3),this.drawVecAt(s,e,this.COLOR_BLACK,!0),this.drawVecAt(a,e,this.COLOR_BLACK,!0),p2.vec2.add(s,s,e),this.drawCircle(s,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(a,a,e),this.drawCircle(a,2/this.factor,this.COLOR_BLACK,1,!0)},i.drawLockJoint=function(t){var e=new Array;new Array;t.bodyA.toWorldFrame(e,t.localOffsetB),this.drawSegment(e,t.bodyA.position,this.COLOR_S),this.drawSegment(e,t.bodyB.position,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK);var i=new Array;t.bodyA.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyA.position,this.COLOR_BLACK),t.bodyB.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyB.position,this.COLOR_BLACK)},i.drawLinearSpring=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=p2.vec2.subtract([],i,e);p2.vec2.normalize(r,r),p2.vec2.scale(r,r,t.restLength);var s=p2.vec2.add([],t.bodyA.position,r);this.drawSegment(s,t.bodyB.position,this.COLOR_RED),this.drawVecAt(r,e,this.COLOR_BLACK),this.drawCircle(e,3/this.factor,this.COLOR_RED),this.drawCircle(s,3/this.factor,this.COLOR_RED)},i.drawRotationalSpring=function(t){var e=new Array,i=new Array;e=t.bodyA.position,i=t.bodyB.position;var r=new Array,s=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(s,[10*(t.bodyB.angle-t.bodyA.angle-t.restAngle+2)/this.factor,0]);var a=p2.vec2.subtract([],r,e),n=p2.vec2.subtract([],s,i);this.drawVecAt(a,e,this.COLOR_RED,!0),this.drawVecAt(n,i,this.COLOR_RED,!0),t.bodyB.toWorldFrame(s,[20/this.factor,0]),this.drawCircle(r,2/this.factor,this.COLOR_RED),this.drawCircle(s,2/this.factor,this.COLOR_RED)},i.drawShape=function(t,e,i,r){var i=void 0==i?this.getColor(e):i,r=void 0==r?!0:r;t instanceof p2.Convex?this.drawConvexShape(t,e,i,r):t instanceof p2.Plane?this.drawPlaneShape(t,e,i,r):t instanceof p2.Circle?this.drawCircleShape(t,e,i,r):t instanceof p2.Capsule?this.drawCapsule(t,e,i):t instanceof p2.Particle?this.drawParticle(t,e,i):t instanceof p2.Line?this.drawLine(t,e,i):t instanceof p2.Heightfield&&this.drawHeightfeild(t,e,i)},i.drawConvexShape=function(t,e,i,r){var s=(e.shapes.indexOf(t),t.position),a=t.angle,n=[],o=this.transformVec(t.vertices[0],s,a);e.toWorldFrame(n,s),e.toWorldFrame(o,o),this.drawSegment(n,o,i);for(var h=new Array,c=t.vertices.length,d=0;c>d;d++)o=this.transformVec(t.vertices[d],s,a),e.toWorldFrame(o,o),h.push(o);this.drawConvex(h,i,.5,r)},i.drawParticle=function(t,e,i){this.drawCircle(e.position,1/this.factor,i,.5),this.drawCircle(e.position,5/this.factor,i,1,!1)},i.drawLine=function(t,e,i){var r=t.length,s=new Array,a=new Array;e.toWorldFrame(s,[-r/2,0]),e.toWorldFrame(a,[r/2,0]),this.drawSegment(s,a,i)},i.drawHeightfeild=function(t,e,i){var r=this.sprite.graphics;r.lineStyle(1,i),r.beginFill(i,.5);var s,a=t.heights,n=t.elementWidth,o=new Array,h=new Array;a.forEach(function(t,i){s=i*n,o=new Array,e.toWorldFrame(o,[s,t]),h.push(o)}),o=new Array,e.toWorldFrame(o,[s,-500]),h.push(o),o=new Array,e.toWorldFrame(o,[0,-500]),h.push(o),o=new Array,e.toWorldFrame(o,[0,0]),h.push(o),this.drawConvex(h,i,.5)},i.drawCapsule=function(t,e,i){var r=t.length,s=t.radius,a=new Array,n=new Array,o=new Array,h=new Array,c=new Array,d=new Array;e.toWorldFrame(a,[-r/2,-s]),e.toWorldFrame(n,[r/2,-s]),e.toWorldFrame(o,[r/2,s]),e.toWorldFrame(h,[-r/2,s]),e.toWorldFrame(c,[r/2,0]),e.toWorldFrame(d,[-r/2,0]),this.drawCircle(c,s,i,.5),this.drawCircle(d,s,i,.5),this.drawConvex([a,n,o,h],i,.5)},i.drawCircleShape=function(t,e,i,r){var s=t.position,a=t.angle,n=new Array;e.toWorldFrame(n,s),this.drawCircle(n,t.radius,i,.5,r);var o=this.transformVec([t.radius,0],s,a);e.toWorldFrame(o,o),this.drawSegment(n,o,i)},i.drawPlaneShape=function(t,e,i,r){var s=new Array,a=new Array;e.shapes.indexOf(t);e.toWorldFrame(s,[1e3,0]),s=this.transformVec(s,t.position,t.angle),a.push(s),s=new Array,e.toWorldFrame(s,[1e3,-1e5]),s=this.transformVec(s,t.position,t.angle),a.push(s),s=new Array,e.toWorldFrame(s,[-1e3,-1e5]),s=this.transformVec(s,t.position,t.angle),a.push(s),s=new Array,e.toWorldFrame(s,[-1e3,0]),s=this.transformVec(s,t.position,t.angle),a.push(s),this.drawConvex(a,i,.5,r)},i.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},i.drawVecAt=function(t,e,i,r){void 0===r&&(r=!1);var s=p2.vec2.copy([],e),a=p2.vec2.add([],t,e);r&&this.drawCircle(s,3/this.factor,i),this.drawSegment(s,a,i)},i.drawVecTo=function(t,e,i,r){void 0===r&&(r=!1);var s=p2.vec2.copy([],e),a=p2.vec2.subtract([],e,t);r&&this.drawCircle(s,3/this.factor,i),this.drawSegment(s,a,i)},i.drawSegment=function(t,e,i){this.sprite.graphics.lineStyle(1,i),this.sprite.graphics.moveTo(t[0]*this.factor,this.winHeight-t[1]*this.factor),this.sprite.graphics.lineTo(e[0]*this.factor,this.winHeight-e[1]*this.factor)},i.drawCircle=function(t,e,i,r,s){void 0===r&&(r=1),this.sprite.graphics.lineStyle(1,i),(s||void 0==s)&&this.sprite.graphics.beginFill(i,r),this.sprite.graphics.drawCircle(t[0]*this.factor,this.winHeight-t[1]*this.factor,e*this.factor),this.sprite.graphics.endFill()},i.drawConvex=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),this.sprite.graphics.lineStyle(1,e),r&&this.sprite.graphics.beginFill(e,i);var s=t.length,a=t[0];this.sprite.graphics.moveTo(a[0]*this.factor,this.winHeight-a[1]*this.factor);for(var n=1;s>=n;n++)a=t[n%s],this.sprite.graphics.lineTo(a[0]*this.factor,this.winHeight-a[1]*this.factor);this.sprite.graphics.endFill()},i.toWorldVector=function(t,e){var i=new Array;return p2.vec2.rotate(i,t,e.angle),i},i.transformVec=function(t,e,i){var r=new Array;return p2.vec2.rotate(r,t,i),p2.vec2.add(r,r,e),r},i.drawDotLine=function(t,e,i,r){if(void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=30),!(t.length<2)){var s=2/this.factor,a=[];p2.vec2.copy(a,t[0]),this.drawCircle(a,s,e,1,!1);for(var n=0;n<t.length-2;n++){var o=t[n];if(i)for(var h=p2.vec2.distance(a,o);h>r/this.factor;){var c=[];p2.vec2.subtract(c,o,a),p2.vec2.scale(c,c,r/this.factor/h),p2.vec2.add(a,a,c),this.drawCircle(a,s,e,1,!1),h=p2.vec2.distance(a,o)}else this.drawCircle(o,s,e,1,!1)}}},t}();egret.registerClass(p2DebugDraw,"p2DebugDraw");var SpritePhysic=function(t){function e(e){t.call(this,e),this.img=new egret.Sprite,this.img.update=function(){},e&&e.onInit&&e.onInit.call(this),this.img.addEventListener(egret.Event.ADDED_TO_STAGE,this.active,this),this.img.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.unactive,this)}__extends(e,t);var i=(__define,e),r=i.prototype;return r.update=function(){this.img.x=this.position[0]*e.factor,this.img.y=e.stageHeight-this.position[1]*e.factor},r.active=function(){this.img&&(this.img.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onChosen,this),this.img.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._onChosen,this))},r.unactive=function(){this.img&&(this.img.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onChosen,this),this.img.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._onChosen,this))},r._onChosen=function(t){0==this.chosenTag&&this.onChosen(this)},r.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e.touchEnabled=!0,e},r.getPos=function(){return{x:this.img.x,y:this.img.y}},r.getDisplayObject=function(){return this.img||this.shapImg},e.maxId=0,e}(p2.Body);egret.registerClass(SpritePhysic,"SpritePhysic");var Ball=function(t){function e(e,i){var r=this;t.call(this,{mass:1,position:[Math.floor(e.posX/SpritePhysic.factor),Math.floor((SpritePhysic.stageHeight-e.posY)/SpritePhysic.factor)],onInit:function(){r.ballType=e.type;var t=new p2.Circle({radius:1});r.addShape(t);var s=new egret.Shape;s.graphics.beginFill(16711680,1),s.graphics.drawCircle(0,0,SpritePhysic.factor),s.graphics.endFill(),s.touchEnabled=!0;var a=t.radius*SpritePhysic.factor,n=new egret.TextField;n.text=e.type,n.anchorOffsetX=Math.ceil(n.width/2),n.anchorOffsetY=Math.ceil(n.height/2),r.ballType=e.type;var o=new egret.Bitmap(i);o.touchEnabled=!0,o.width=2*a,o.height=2*a,o.anchorOffsetX=a,o.anchorOffsetY=a,r.img.width=a,r.img.height=a,r.img.addChild(o)}})}__extends(e,t);var i=(__define,e),r=i.prototype;return r.pos=function(t,e){this.position=[t/SpritePhysic.factor,(SpritePhysic.stageHeight-e)/SpritePhysic.factor]},r.distance=function(t,e){var i=this.getPos(),r=t-i.x,s=e-i.y;return Math.sqrt(r*r+s*s)},e}(SpritePhysic);egret.registerClass(Ball,"Ball",["AtomBall"]);var TemplateMgr=function(){function t(){this.BallTemplate={}}var e=(__define,t),i=e.prototype;return i.createBall=function(t){var e=null;if(this.BallTemplate[t]){var i=RES.getRes(t+"_png");e=new Ball(this.BallTemplate[t],i)}return e},t}();egret.registerClass(TemplateMgr,"TemplateMgr");var Template=new TemplateMgr;Template.BallTemplate.O2={posX:0,posY:0,type:"O2"},Template.BallTemplate.C={posX:0,posY:0,type:"C"},Template.BallTemplate.H2={posX:0,posY:0,type:"H2"},Template.BallTemplate.Na={posX:0,posY:0,type:"Na"},Template.BallTemplate.N2={posX:0,posY:0,type:"N2"},Template.BallTemplate.H2S={posX:0,posY:0,type:"H2S"},Template.BallTemplate.H2O={posX:0,posY:0,type:"H2O"},Template.BallTemplate.Si={posX:0,posY:0,type:"Si"};var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,r){function s(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);